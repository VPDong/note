# PWD学习笔记

破解时采取先易后难的原则，建议如下：

+ 利用收集的公开字典进行破解
+ 使用1-8位数字进行破解
+ 使用1-8位小写字母进行破解
+ 使用1-8位大写字母进行破解
+ 使用1-8位混合大小写+数字+特殊字符进行破解



## 一、Crunch

格式为：`crunch <min-length> <max-length> [charset1 charset2 charset3 charset4] [options]`。其中**charset顺序为小写、大写、数字、符号，使用占位符(加号)代表对应位置的默认内置集合**，如不按照该顺序将得不到预期结果。

### 常用参数

+ -t：指定生成密码的格式，其中符号**"@"代表小写字母，","代表大写字母，"%"代表数字，"\^"代表符号，"+"代表占位符**

  > 如`crunch 4 4 + + 123 + -t %%@^`，生成4位密码：为“两个数字”+“一个小写字母”+“常见符号”，其中数字这里被指定只能为123组成的所有2位数字组合。同时该选项可搭配的选项有如下：
  >
  > + -l：指定-t中哪些*符号*被当成文字。这将允许使用占位符作为模式中的字母，**-l选项应与-t选项的长度相同，-l中的每位如果与-t中的对应位相同则代表为处理成文字而非模式**。
  >
  >   > 如`crunch 7 7 -t p@ss,%^ -l +@+++++`：将模式串中的@作为文字字符集，而不是作为小写字母进行替换
  >
  > + -p： 指定-t中*占位符*的取值集合，集合中元素长度都记为1。**此选项不能与-s一起使用，且该项一定要放在命令的最后** 

+ -d：限制出现相同元素的个数

+ -s：指定密码开始生成的位置

+ -e：指定密码结束生成的位置

+ -c：指定输出文件的行数，即包含密码的个数

+ -b：指定输出文件的大小，避免字典文件过大

+ -o：指定输出文件，另外也可使用"-"引用生成的密

  > 如`crunch 2 4 0123456789 | aircrack-ng a.cap -e MyESSID -w -`，参数最后面的-表示引用crunch生成的密码

另外，可以通过如下命令进行整理：

+ [sort](http://www.runoob.com/linux/linux-comm-sort.html)：它将文件进行排序，并将排序结果标准输出。它既可从特定的文件，也可以stdin中获取输入

  > + -b：忽略每行前面开始出的空格字符
  > + -d：忽略除英文字母、数字及空格字符外其他的字符
  > + -u：忽略相同行，仅显示重复出现的行列。可以排序后直接用**uniq**命令，但是这样效率低下
  > + -o <输出文件>：将排序后的结果存入制定的文件

+ sed：是一种在线编辑器，它一次处理一行内容。处理时把当前处理的行存储在临时缓冲区中，接着用sed命令处理缓冲区中的内容，处理完成后把缓冲区的内容送往屏幕后接着处理下一行，这样不断重复直到文件末尾

  > + `s表示替换命令`
  > + `g表示此行中替换所有的匹配`
  > + `/asd/qwe/ 表示匹配asd，并写入qwe`
  > + `. 表示任何单个字符`
  > + `*表示某个字符出现了0次或多次`
  > + `^表示行首，如/^#/表示以#开头的匹配`
  > + `$表示行尾，如/}$/表示以}结尾的匹配`
  > + `\< 表示词首， 如\<abc表示以abc为首的词`
  > + `\> 表示词尾。 如abc\>表示以abc结尾的词`
  > + `[ ]表示字符集合。 如[abc]表示匹配a或b或c，[a-zA-Z]表示匹配所有的26个字符，[ \t]表示以空格或者TAB键。如果其中有^表示反，如[^a]表示非a的字符`

  下面是sed一些常用方式：

  > + `sed 's/^ *//' <file> > <savefile>`：删除每行开头的空格。
  > + `sed 's/^[ \t]*//g' <file> > <savefile>`：删除每行开头的空格键和TAB键。
  > + `sed 's/[ \t]*$//g' <file> > <savefile>`：删除每行结尾的空格键和TAB键。
  > + `sed '/^$/d' <file> > <savefile>`：删除空行。
  > + `sed 's/.//' <file> > <savefile>`：删除每行第一个字符。
  > + `sed 's/..//' <file> > <savefile>`：删除每行前两个字符。
  > + `sed 's/.\{5\}//' <file> > <savefile>`：删除每行前k个字符，例如k=5。



## 二、hashcat

Hashcat中的密码破译，其实是通过碰撞比较，匹配出相应的明文。所以在密码破译过程中，使用的字典就显得尤其重要。但是字典不是万能的，所以才需要结合掩码、规则等攻击模式，设计合适的密码爆破命令。一般来说，越符合人类设计口令习惯的爆破命令，破译出的口令明文越多。

格式为：`hashcat [options] <hash|file|hccapx> -o <file> [pwdfileN...|pwddir|mask]`。

### 常用参数

+ -b：用于基准测试，测试计算机破解速度和显示硬件相关信息

+ -m：指定要破解的hash模式，如果不指定m值则默认指MD5(0)，通过`hashcat -h`查看Hash modes

+ -a：指定要使用的攻击方式，常见的有0(字典攻击)、1(组合攻击)、3(掩码攻击)、6/7(混合模式)

+ --increment：启用增量破解模式，可利用此模式让hashcat在指定的密码长度范围内执行破解过程

+ --increment-min：密码最小长度，后面直接等于一个整数即可。配合increment模式一起使用

+ --increment-max：密码最大长度，后面直接等于一个整数即可。配合increment模式一起使用

+ --force：忽略破解过程中的警告信息，跑单条hash可能需要加上此选项

+ --show：显示已经破解的hash及该hash所对应的明文

+ --remove ：把密文文件中已经破译的密码筛除，仅留下不能破译的密码

+ -D：opencl-device-types，即主要用于选定1(CPU)、2(GPU)、3(FPGA, DSP, Co-Processor)

+ -O：optimized-kernel-enable，即主要用于优化内核，在mac系统上使用时需要输入该参数

+ -o：指定破解成功后的hash及所对应的明文密码的存放位置，可用它把破解成功的hash写到指定的文件中

  > 通过--potfile-disable命令进行设置可防止如下的问题：正常情况下，-o命令会把匹配出的密码输出到outfile文件。但是在实验过程中出现了一个问题，即没有在路径下生成outfile文件。这是因为hashcat在破译密码的过程中，会把破译的结果(有本次破译出的密码和对应的结果)缓存到hashcat.potfile文件，当下次破译遇到同样的密码表，会从potfile文件中直接获取。

### 攻击方式

+ 字典攻击：顾名思义，逐字典逐条读取后进行验证，字典个数没有限制

+ 组合攻击：顾名思义，两字典交叉组合后进行验证，只能支持两个字典

+ 掩码攻击：内置了8种默认字符集：l(小写字母 26个)、u(大写字母 26个)、d(数字 10个)、s(特殊字符 31)、a(l,u,d,s的合集)以及b(二进制的0x00-0xFF0)、h(小写16进制字符)、H(大写16进制字符)。下面是一些例子：

  > + 口令长度为6，第一位是全字符集、第二位是小写字母、第三位是大写字母、第四、五、六位为全字符集：?a?l?u?a
  > + 口令长度为6，第一、四位为大小写+数字，第二位为大小写，第三、五位为大写+数字，第六位为数字：-1 ?l?u?d -2?l?u -3 ?u?d ?1?2?3?1?3?d，**在这通过<-num>定义了一个集合符号，在后面掩码中进行了使用**
  > + 口令长度为6位，第一、三位在“43545yt”中，第二、四位在“345dfv-=+”中，第五、六位在“9vjnbbf-brg”中：-1 43545yt -2  345dfv-=+ -3 9vjnbbf-brg ?1?2?1?2?3?3。当然也可以将这些字符写成不同的文件进行使用，有些符号在命令行中会有特殊含义，所以当字符集中有特殊符号时最好把这些符号写成文件形式。

+ 混合模式：是对字典+掩码(命令参数为-a 6)和掩码+字典(命令参数为-a 7)这两种模式的合称。使用教程在[这里](https://www.freebuf.com/articles/network/176660.html)。

  > 如在破译密码的中发现口令库中会存在大量类似sina0001\tencent2013\sohu1988这样的口令，使用改模式很好解决字典问题
  >
  > 注意使该模式通过文件定义时，只能使用一个掩码文件。使用多个掩码文件时会把第二个掩码文件当做字典进行组合。
  >
  > 举例如：`hashcat -a 7 -m 0 hash.txt -1 ?l?u ?l?d pwd1.txt pwd2.txt `

+ 规则攻击：通过--rule-file使用，他会把规则文件中的多条规则作用于字典中的每条记录。

  > 所谓规则即是类似于生成候选密码的编程语言，规则由多个具有不同功能的函数组成，它可以修改\剪切\扩展单词或者是根据条件操作符跳过一些操作，从而可以更加灵活高效的进行攻击。规则文件可自己生成，也可使用hashcat自带的规则文件(hashcat自带的规则文件通常在rules文件夹下)。了解更多hashcat的规则函数，请点[这里](https://www.freebuf.com/articles/network/177398.html)或[这里](https://hashcat.net/wiki/doku.php?id=rule_based_attack)。

字典下载网站可以去这里看看：http://contest-2010.korelogic.com/wordlists.html

操作系统密码破解可以参考这里：https://www.freebuf.com/sectool/164507.html



## 三、hydra

hydra是著名黑客组织thc的一款开源的暴力密码破解工具，可以在线破解多种密码，是一个支持众多协议的爆破工具。

格式为：`hydra [options] <IP> <service> [path] `

### 常用参数

+ -C：当用户名和密码存储到一个文件时使用。注意文件(字典)存储的格式必须为 "用户名:密码" 的格式

+ -l：指定单个登录名，适合在知道用户名爆破用户名密码时使用

+ -L：指定多个登录名，参数值为存储用户名的文件的绝对路径

+ -p：指定单个登录密码，适合在知道密码爆破用户名时使用

+ -P：指定多个登录密码，参数值为存贮登录密码的文件的绝对路径

+ -m：为一个模块指定OPT选项

+ -M：指定多个攻击目标，此参数为存储攻击目标的文件的绝对路径。注意列表文件存储格式必须为 "地址:端口"

+ -s：指定端口，适用于攻击目标端口非默认的情况。如http服务使用非80端口

+ -S：指定爆破时使用SSL链接

+ -U：查看某服务是否需要额外的参数，如查看ssh模块`hydra -U ssh`，又如http(get)`hydra -U http-get`

+ -t：指定爆破时的任务数量(可以理解为线程数)，默认为16

  > 在爆破过程中，要适当的使用爆破的线程数。比如ssh一般有连接数量的苛刻限制，连接数量不得超过4。如果使用hydra默认的线程数，有些线程会连接失败，从而导致字典中有正确密码而无法爆破现象。

+ -f：一但爆破成功一个就停止爆破

+ -o：将爆破的登录名/密码写到文件，而不是在终端显示

下面是举例说明：

```shell
# get方式提交，破解web登录
hydra -l 用户名 -p 密码字典 -t 线程 -f ip http-get /admin/login.php

# post方式提交，破解web登录。这里要注意后面path中指定了post内容的key
hydra -l 用户名 -P 密码字典 -t 线程 -f ip http-post-form "/admin/login.php:username=^USER^&password=^PASS^&submit=login:sorry password" # sorry是表示错误猜解的返回信息提示
hydra -l 用户名 -P 密码字典 -t 线程 -f ip http-post-form "/admin/login.php:id=^USER^&passwd=^PASS^:<title>wrong username or password</title>" # <title>是表示错误猜解的返回信息提示
```

