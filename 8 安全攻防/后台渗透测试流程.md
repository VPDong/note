# 后台渗透测试流程

渗透测试的前提是得经过用户的授权，才可以对网站进行渗透。如果没有经过客户的授权而对一个网站进行渗透测试的话，这是违法的。2017年6月1日起施行《网络安全法》，对网络犯罪有了法律约束，不懂的移步 [网络安全法](https://baike.baidu.com/item/中华人民共和国网络安全法/16843044?fromtitle=网络安全法&fromid=12291792&fr=aladdin)。

## 信息收集

信息收集的方式可以分为主动和被动。动信息收集是通过直接访问、扫描网站，这种流量将流经网站；被动信息收集是利用第三方的服务对目标进行访问了解，比例Google搜索、Shodan搜索等。主动方式能获取更多的信息，但目标主机可能会记录你的操作记录。被动方式能收集的信息会相对较少，但你的行动并不会被目标主机发现。一般在一个渗透项目下需要有多次的信息收集，同时也要运用不同的收集方式，才能保证信息收集的完整性。*附加一篇好文[《攻防视角下的信息收集》](https://mp.weixin.qq.com/s/XRulzmBQbV59nsDpTvmJ2Q)*。而信息收集到底要收集哪些信息呢？

### 主机确定

当确定了要渗透的目标，也就是知道了其域名，接下来需要收集域名ip信息、whois信息、子域名等等一系列与域名相关的信息：

域名的IP信息：可通过“[站长之家的ping检测](http://ping.chinaz.com/)”，如查询出的ip数量大于一个的话，则说明该ip地址不是真实的服务器地址。绕过CDN查找网站真实ip的方法常见如下：

+ 主域名查询：以前用CDN的时候有个习惯，只让www域名使用cdn，秃域名不适用(为的是在维护网站时更方便，不用等cdn缓存)。所以试着把目标网站的www去掉，ping一下看ip是不是变了，别说，这个方法还真是屡用不爽。
+ 子域名查询：毕竟CDN还是不便宜的，所以很多站长可能只会对主站或者流量大的子站点做了CDN，而很多小站子站点又跟主站在同一台服务器或者同一个C段内，此时就可以通过查询子域名对应的IP来辅助查找网站的真实IP。获取子域名可以通过**Layer子域名爆破机**、**subDomainBrute**等获取。
+ SSL证书查询：利用“Censys网络空间搜索引擎”搜索网站的SSL证书及HASH，在https://crt.sh上查找目标网站SSL证书的HASH，然后再用Censys搜索该HASH即可得到真实IP地址。
+ 国外进行访问：国内的CDN往往只对国内用户的访问加速，而国外的CDN就不一定了。因此通过国外在线代理网站https://asm.ca.com/en/ping.php访问 ，可能会得到真实的ip地址。
+ 域名历史解析记录查询：也许目标很久之前没有使用CDN，所以可能会存在使用 CDN 前的记录。所以可以通过网站[https://www.netcraft.com](https://www.netcraft.com/)来观察域名的IP历史记录。

域名的whois信息：可通过“[站长之家的whois查询](http://whois.chinaz.com/)”。

对应社工的信息：当确定了公司后，可以去互联网上查询与该公司有关的任何信息。比如公司的邮箱格式、公司的员工姓名、与该公司有关的任何信息。通过这些信息可以进行一些社会工程入侵。
### 端口扫描

需要知道目标服务器开放了哪些端口，常见的如 135 、137 、138 、139 、445，这几个端口经常爆发漏洞。另外附[《常见危险端口服务及对应的漏洞》](http://blog.csdn.net/qq_36119192/article/details/84781477)。端口扫描工具常用的为nmap。

### 整站分析

整站分析包括服务器类型、网站容器、网站目录等：

+ 服务器类型：可通过nmap进行扫描(-O和-A参数都能扫描出来)
+ 网站容器：对目标服务器进行指纹识别是相当有必要的，因为只有识别出相应的Web容器或者CMS，才能查找与其相关的漏洞，然后才能进行相应的渗透操作。CMS又称整站系统，常见的CMS有：WordPress、Dedecms、Discuz、PhpWeb、PhpWind、Dvbbs、PhpCMS、ECShop、SiteWeaver、AspCMS、Z-Blog、帝国等。常见的网站指纹识别工具有[WhatWeb](https://whatweb.net/)、[BugScaner](http://whatweb.bugscaner.com/look/)、[云悉指纹](http://www.yunsee.cn/finger.html)等。需要知道网站用的web服务器是什么类型的：apache、nginx、tomcat还是IIS。知道了web服务器是哪种类型后，还要探测web服务器具体的版本。比如Ngnix版本<0.83会有解析漏洞、IIS6.0会有文件名解析漏洞、IIS7.0会有畸形解析漏洞等。不同的web服务器版本，存在着不同漏洞。
+ 网站目录：扫描网站目录结构，看看是否可以遍历目录或者敏感文件泄漏。常用的目录工具为wwwscan和dirbuster。



## 漏洞探测





## 漏洞利用





## 内网转发





## 内网渗透





## 痕迹清除





## 撰写报告





